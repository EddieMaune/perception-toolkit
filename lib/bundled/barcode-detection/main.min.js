this.PerceptionToolkit=this.PerceptionToolkit||{},this.PerceptionToolkit.main=function(t){"use strict";function e(t){return new Promise((e,n)=>{const i=document.createElement("script");i.src=t,i.onload=e,i.onerror=n,document.head.appendChild(i)})}var n;function i(t,e=n.INFO,i){if("undefined"==typeof DEBUG||e>DEBUG)return;const o=function(t,e){let i="";switch(t){case n.WARNING:i="WARNING";break;case n.ERROR:i="ERROR";break;default:i="INFO"}if(!e)return`${i}:`;return`${i} [${e}]:`}(e,i);switch(e){case n.ERROR:console.error(o,t);break;case n.WARNING:console.warn(o,t);break;default:console.log(o,t)}}let o;async function r(t,{context:s=window,forceNewDetector:a=!1,polyfillRequired:c=!1,polyfillPrefix:d=""}={}){(c||s===window&&!("BarcodeDetector"in s))&&(i("Using barcode detection polyfill",n.INFO,"BarcodeDetector"),await e(`${d}/lib/polyfills/barcode-detector.js`)),o&&!a||(o=new s.BarcodeDetector),"isReady"in o&&await o.isReady;try{return await o.detect(t)}catch(e){return c?[]:(i(`Detection failed: ${e.message}`,n.WARNING),await r(t,{context:s,forceNewDetector:a,polyfillPrefix:d,polyfillRequired:!0}))}}!function(t){t[t.VERBOSE=4]="VERBOSE",t[t.INFO=3]="INFO",t[t.WARNING=2]="WARNING",t[t.ERROR=1]="ERROR",t[t.NONE=0]="NONE"}(n||(n={}));const s="\n:host {\n  --baseline: 8px;\n  --height: calc(var(--baseline) * 6);\n  position: relative;\n  display: flex;\n  height: var(--height);\n}\n\nbutton {\n  width: 100%;\n  height: 100%;\n  align-items: center;\n  border: none;\n  background: none;\n  font-size: 15px;\n  color: #888;\n  cursor: pointer;\n  white-space: nowrap;\n  padding: var(--baseline) calc(var(--baseline) * 2);\n}\n\nbutton:focus,\nbutton:hover {\n  color: #222;\n}\n",a="<button></button>";class c extends HTMLElement{constructor(){super(),this.labelInternal=c.DEFAULT_LABEL,this.root=this.attachShadow({mode:"open"})}connectedCallback(){this.root.innerHTML=`<style>${s}</style> ${a}`,this.render()}get label(){return this.labelInternal}set label(t){this.labelInternal=t,this.render()}render(){const t=this.root.querySelector("button");t&&(t.textContent=this.label)}}function d(t,e=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY){return Math.max(e,Math.min(n,t))}function l(t){return 1-Math.pow(1-t,3)}c.defaultTagName="action-button",c.DEFAULT_LABEL="Button";const h=new WeakMap;function u(t,{from:e=1,to:n=0,duration:i=250,ease:o=l}={}){return new Promise(r=>{const s=h.get(t);s&&(cancelAnimationFrame(s.id),h.delete(t),s.resolve()),t.style.opacity=e.toString();const a=self.performance.now(),c=()=>{const s=d((self.performance.now()-a)/i,0,1),l=e+(n-e)*o(s);t.style.opacity=l.toString(),s<1?h.set(t,{id:requestAnimationFrame(c),resolve:r}):(t.style.opacity=n.toString(),h.delete(t),r())};h.set(t,{id:requestAnimationFrame(c),resolve:r})})}const m="\n:host {\n  --baseline: 16px;\n  --background: #FFF;\n  --borderRadius: 5px;\n  --color: #333;\n  --fontFamily: 'Arial', 'Helvetica', sans-serif;\n  --padding: calc(var(--baseline) * 2)\n      calc(var(--baseline) * 2)\n      calc(var(--baseline) * 1)\n      calc(var(--baseline) * 2);\n\n  position: relative;\n  display: inline-block;\n  align-items: center;\n  justify-content: center;\n  overflow: hidden;\n  border-radius: var(--borderRadius);\n  font-family: var(--fontFamily);\n  background: var(--background);\n  color: var(--color);\n}\n\n#container {\n  white-space: nowrap;\n}\n\n#container.padded {\n  padding: var(--padding);\n}\n\n#close {\n  width: 24px;\n  height: 24px;\n  background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTkgNi40MUwxNy41OSA1IDEyIDEwLjU5IDYuNDEgNSA1IDYuNDEgMTAuNTkgMTIgNSAxNy41OSA2LjQxIDE5IDEyIDEzLjQxIDE3LjU5IDE5IDE5IDE3LjU5IDEzLjQxIDEyeiIvPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz48L3N2Zz4=);\n  position: absolute;\n  top: 8px;\n  right: 8px;\n  font-size: 0;\n  border: none;\n  cursor: pointer;\n  opacity: 0.7;\n  transition: opacity 0.3s cubic-bezier(0, 0, 0.3, 1);\n}\n\n#close:hover {\n  opacity: 1;\n}\n\nslot::slotted(*) {\n  flex: 1;\n  border-right: 1px solid #CCC;\n}\n\nslot::slotted(*:last-child) {\n  border-right: none;\n}\n\nslot {\n  display: flex;\n  border-top: 1px solid #AAA;\n}\n\n:host(:empty) slot {\n  border: none;\n}\n\n#title {\n  padding: var(--baseline);\n  font-size: 14px;\n  font-weight: 400;\n  margin: 0;\n}\n\n#description {\n  padding: var(--baseline);\n  font-size: 16px;\n  font-weight: 400;\n  min-height: calc(var(--baseline) * 2);\n  margin: 0;\n}\n\n#image {\n  background-color: #111;\n  background-size: cover;\n  background-position: center center;\n  min-width: 300px;\n  min-height: 210px;\n  transition: background-image 1s ease-out;\n}\n",f='\n  <button id="close">Close</button>\n  <div id="container"></div>\n  <div id="slotted-content"><slot></slot></div>\n';class p extends HTMLElement{constructor(){super(),this.fadeDuration=200,this.sandboxAttribute="allow-same-origin",this.srcInternal="",this.root=this.attachShadow({mode:"open"}),this.onClickBound=this.onClick.bind(this)}get src(){return this.srcInternal}set src(t){this.srcInternal=t,this.render()}get width(){return this.widthInternal}set width(t){this.widthInternal=t,this.setDimensions()}get height(){return this.heightInternal}set height(t){this.heightInternal=t,this.setDimensions()}connectedCallback(){this.root.innerHTML=`<style>${m}</style> ${f}`,this.render(),this.setDimensions(),this.addEventListener("click",this.onClickBound)}disconnectedCallback(){this.removeEventListener("click",this.onClickBound)}async close(t=this.fadeDuration){0!==t?(await u(this,{duration:t}),this.remove()):this.remove()}async onClick(t){"close"===(t.path?t.path[0]:t.composedPath()[0]).id&&await this.close()}render(){const t=this.root.querySelector("#container");if(t)if(t.classList.remove("padded"),this.srcIsString(this.src))t.textContent=this.src,t.classList.add("padded");else if(this.srcIsCardData(this.src))this.renderCardData(this.src);else if(this.srcIsUrl(this.src)){const e=document.createElement("iframe");e.src=this.src.toString(),e.setAttribute("sandbox",this.sandboxAttribute),e.style.border="none",e.id="external-content",e.width=(this.width||0).toString(),e.height=(this.height||0).toString(),t.appendChild(e)}else console.warn("Unexpected card content",this.src),t.textContent="Unexpected content",t.classList.add("padded")}renderCardData(t){const e=this.root.querySelector("#container");if(e){if(e.innerHTML="",t.name){const n=document.createElement("h1");n.setAttribute("id","title"),n.textContent=t.name,e.appendChild(n)}if(t.image){const n=document.createElement("div");n.setAttribute("id","image"),n.style.backgroundImage=`url(${t.image})`,e.appendChild(n)}if(t.description){const n=document.createElement("div");n.setAttribute("id","description"),n.textContent=t.description,e.appendChild(n)}}}srcIsString(t){return"string"==typeof t}srcIsCardData(t){return"object"==typeof t&&void 0===t.href}srcIsUrl(t){return"object"==typeof t&&void 0!==t.href}setDimensions(){const t=this.root.querySelector("#container");t&&(this.widthInternal&&(t.style.width=`${this.widthInternal}px`),this.heightInternal&&(t.style.height=`${this.heightInternal}px`))}}p.defaultTagName="data-card";const g="\n:host {\n  --color: #999;\n  --dotSize: 8px;\n  --dotMargin: 4px;\n  display: flex;\n}\n\n.dot {\n  border-radius: 50%;\n  width: var(--dotSize);\n  height: var(--dotSize);\n  background: var(--color);\n  margin: var(--dotMargin);\n  animation: bounceHorizontal 1s infinite cubic-bezier(0, 0, 0.4, 1);\n}\n\n:host([vertical]) .dot {\n  animation-name: bounceVertical;\n}\n\n.dot:nth-of-type(2) {\n  animation-delay: 0.1s;\n}\n\n.dot:nth-of-type(3) {\n  animation-delay: 0.2s;\n}\n\n.dot:nth-of-type(4) {\n  animation-delay: 0.3s;\n}\n\n@keyframes bounceHorizontal {\n  0% {\n    transform: none;\n  }\n\n  50% {\n    transform: translateX(-10px);\n  }\n\n  100% {\n    transform: none;\n  }\n}\n\n@keyframes bounceVertical {\n  0% {\n    transform: none;\n    animation-timing-function: ease-in;\n  }\n\n  10% {\n    transform: translateY(-4px);\n    animation-timing-function: ease-in-out;\n  }\n\n  30% {\n    transform: translateY(4px);\n    animation-timing-function: ease-out;\n  }\n\n  40% {\n    transform: none;\n  }\n\n  100% {\n    transform: none;\n  }\n}\n",b='\n  <div class="dot"></div>\n  <div class="dot"></div>\n  <div class="dot"></div>\n  <div class="dot"></div>';class v extends HTMLElement{constructor(){super(),this.root=this.attachShadow({mode:"open"})}connectedCallback(){this.root.innerHTML=`<style>${g}</style> ${b}`}}v.defaultTagName="dot-loader";const y={name:"IntersectionObserver",supported:async()=>"IntersectionObserver"in self&&"IntersectionObserverEntry"in self};function w(t,e,n){const i=new CustomEvent(t,{bubbles:!0,detail:n});e.dispatchEvent(i)}const I="\n:host {\n  --background: #FFF;\n  --borderRadius: 4px;\n  --color: #333;\n  --fontFamily: 'Arial', 'Helvetica', sans-serif;\n  --padding: 8px 8px 36px 8px;\n  --buttonBottomMargin: 8px;\n  --buttonSideMargin: 4px;\n  --buttonActiveColor: #444;\n  --buttonHoverColor: #666;\n  --buttonInactiveColor: #AAA;\n  --contentBorderRadius: 0px;\n\n  position: relative;\n  align-items: center;\n  justify-content: center;\n  display: flex;\n  flex-direction: column;\n  outline: none;\n  z-index: 1;\n\n  padding: var(--padding);\n  border-radius: var(--borderRadius);\n  font-family: var(--fontFamily);\n  background: var(--background);\n}\n\n#container {\n  color: var(--color);\n  overflow: hidden;\n  border-radius: var(--contentBorderRadius);\n  display: block;\n  cursor: pointer;\n}\n\nslot {\n  display: flex;\n  overflow-x: scroll;\n  scroll-snap-type: x mandatory;\n  scrollbar-width: none;\n}\n\nslot::-webkit-scrollbar {\n  display: none;\n}\n\n::slotted(*) {\n  flex: 1 0 auto;\n  scroll-snap-align: start;\n}\n\n#buttons {\n  display: flex;\n  height: 20px;\n  align-items: center;\n  justify-content: center;\n  position: absolute;\n  bottom: var(--buttonBottomMargin);\n}\n\n#buttons button {\n  margin: 0 var(--buttonSideMargin);\n  font-size: 0;\n  width: 18px;\n  height: 18px;\n  position: relative;\n  background: none;\n  border: none;\n  cursor: pointer;\n}\n\n#buttons button::after {\n  content: '';\n  background: var(--buttonInactiveColor);\n  width: 8px;\n  height: 8px;\n  border-radius: 50%;\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n}\n\n#buttons button::after:hover {\n  background: var(--buttonHoverColor);\n}\n\n#buttons button.active::after {\n  background: var(--buttonActiveColor);\n}\n",x='\n<div id="container">\n  <slot></slot>\n  </div>\n<div id="buttons"></div>',E="/third_party/intersection-observer/intersection-observer-polyfill.js";class k extends HTMLElement{constructor(){super(),this.ready=async function(t=!1){if(!t&&await y.supported())return!0;try{return await e(E),IntersectionObserver.prototype.POLL_INTERVAL=300,i("Loaded IntersectionObserver polyfill",n.INFO,"Onboarding"),!0}catch(t){return i("Intersection Observer polyfill load failed",n.ERROR,"Onboarding"),!1}}(),this.root=this.attachShadow({mode:"open"}),this.itemsInView=new Set,this.modeInternal="scroll",this.itemInternal=0,this.itemMax=0,this.widthInternal=0,this.heightInternal=0,this.onSlotChangeBound=this.onSlotChange.bind(this),this.onContainerClickBound=this.onContainerClick.bind(this),this.onButtonClickBound=this.onButtonClick.bind(this),this.onIntersectionBound=this.onIntersection.bind(this)}static get observedAttributes(){return["width","height","mode"]}get width(){return this.widthInternal}set width(t){Number.isNaN(t)&&(t=0),this.setAttribute("width",t.toString())}get height(){return this.heightInternal}set height(t){Number.isNaN(t)&&(t=0),this.setAttribute("height",t.toString())}get item(){return this.itemInternal}get mode(){return this.modeInternal}set mode(t){this.setAttribute("mode",t)}connectedCallback(){this.ready.then(()=>{this.root.innerHTML=`<style>${I}</style> ${x}`;const t=this.root.querySelector("slot"),e=this.root.querySelector("#container"),n=this.root.querySelector("#buttons");t.addEventListener("slotchange",this.onSlotChangeBound),e.addEventListener("click",this.onContainerClickBound),n.addEventListener("click",this.onButtonClickBound),this.setAttribute("tabindex","0"),this.observer=new IntersectionObserver(this.onIntersectionBound,{root:e,rootMargin:"-5px",threshold:0}),this.updateCardDimensions(),this.observeChildren(),this.onSlotChange()})}disconnectedCallback(){const t=this.root.querySelector("slot"),e=this.root.querySelector("#container"),n=this.root.querySelector("#buttons");t.removeEventListener("slotchange",this.onSlotChangeBound),e.removeEventListener("click",this.onContainerClickBound),n.addEventListener("click",this.onButtonClickBound),this.unobserveChildren(),this.root.innerHTML=""}attributeChangedCallback(t,e,n){switch(t){case"width":{const t=Number(n);this.widthInternal=Number.isNaN(t)?0:t;break}case"height":{const t=Number(n);this.heightInternal=Number.isNaN(t)?0:t;break}case"mode":this.modeInternal="fade"===n?"fade":"scroll"}this.updateCardDimensions()}async next(){const t=this.itemInternal;this.itemInternal=d(this.itemInternal+1,0,this.itemMax-1),await this.gotoItem({from:t}),t===this.itemInternal&&w(k.onboardingFinishedEvent,this,{item:this.itemInternal})}async gotoItem({to:t=this.itemInternal,from:e=-1}={}){const n=this.getSlotElements();n[t]&&(-1===e||n[e])&&e!==t&&("fade"===this.mode?(-1!==e&&(await u(n[e],{from:1,to:0}),n[e].style.opacity="1"),n[t].scrollIntoView(),this.itemsInView.add(n[t]),await u(n[t],{from:0,to:1})):n[t].scrollIntoView({behavior:"smooth"}),this.setLabel())}setLabel(){const t=this.getSlotElements();t[this.item]&&this.setAttribute("aria-label",t[this.item].getAttribute("alt")||"No description provided")}onContainerClick(){this.next()}async onButtonClick(t){const e=this.root.querySelector("#buttons");let n=Array.from(e.childNodes).indexOf(t.target);-1===n&&(n=0);const i=this.itemInternal;this.itemInternal=n,await this.gotoItem({from:i})}onIntersection(t){const e=this.getSlotElements();for(const n of t){if(n.isIntersecting?this.itemsInView.add(n.target):this.itemsInView.delete(n.target),1!==this.itemsInView.size)continue;const t=Array.from(this.itemsInView);this.itemInternal=e.indexOf(t[0]),w(k.itemChangedEvent,this,{item:this.itemInternal})}const n=this.root.querySelectorAll("#buttons button");for(const[t,e]of n.entries())e.classList.toggle("active",t===this.itemInternal)}observeChildren(){const t=this.getSlotElements();for(const e of t)this.observer.observe(e)}unobserveChildren(){const t=this.getSlotElements();for(const e of t)this.observer.observe(e)}getSlotElements(){const t=this.root.querySelector("slot");return t?"assignedElements"in t?t.assignedElements():t.assignedNodes().filter(t=>t.nodeType===this.ELEMENT_NODE):[]}onSlotChange(){const t=this.root.querySelector("#buttons"),e=this.getSlotElements();if(this.itemMax=e.length,t){t.innerHTML="";for(let e=0;e<this.itemMax;e++){const n=document.createElement("button");n.textContent=`${e+1}`,t.appendChild(n)}this.setLabel()}}updateCardDimensions(){const t=this.root.querySelector("#container");t&&(t.style.width=`${this.width}px`,t.style.height=`${this.height}px`)}}k.onboardingFinishedEvent="onboardingfinished",k.itemChangedEvent="itemchanged",k.defaultTagName="onboarding-card";const C=document.createElement("div");function A(t,e=document.body){return C.textContent=t,e.appendChild(C),C}function S(){C.remove()}C.attachShadow({mode:"open"}).innerHTML='<style>\n:host {\n  --baseline: 12px;\n  position: fixed;\n  display: block;\n  top: 50%;\n  left: 50%;\n  min-width: 280px;\n  padding: var(--baseline) calc(var(--baseline) * 2);\n  background: rgba(0, 0, 0, 0.5);\n  border-radius: 20px;\n  color: #FFF;\n  transform: translate(-50%, -50%);\n  text-align: center;\n  font-family: Arial, Helvetica, sans-serif;\n  font-size: 18px;\n  z-index: 2;\n}\n</style><span class="content"><slot></slot></span>';const N="\n:host {\n  position: relative;\n  display: flex;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  background: #333;\n  animation: fadeIn 0.3s cubic-bezier(0, 0, 0.3, 1) forwards;\n  --baseline: 12px;\n}\n\ncanvas {\n  width: 100%;\n  max-width: 100%;\n  max-height: 100%;\n  object-fit: contain;\n  background: #111;\n}\n\n#reticle {\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n  position: absolute;\n  opacity: 0;\n  transition: opacity 0.3s cubic-bezier(0, 0, 0.3, 1);\n}\n\n#close {\n  width: calc(var(--baseline) * 3);\n  height: calc(var(--baseline) * 3);\n  background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTkgNi40MUwxNy41OSA1IDEyIDEwLjU5IDYuNDEgNSA1IDYuNDEgMTAuNTkgMTIgNSAxNy41OSA2LjQxIDE5IDEyIDEzLjQxIDE3LjU5IDE5IDE5IDE3LjU5IDEzLjQxIDEyeiIvPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz48L3N2Zz4=);\n  background-color: #FFF;\n  background-position: center center;\n  background-repeat: no-repeat;\n  position: absolute;\n  top: 8px;\n  right: 8px;\n  font-size: 0;\n  border: none;\n  border-radius: 50%;\n  cursor: pointer;\n}\n\n.overlay {\n  position: absolute;\n  bottom: 50px;\n  left: 50%;\n  min-width: 280px;\n  padding: var(--baseline) calc(var(--baseline) * 2);\n  background: rgba(0, 0, 0, 0.5);\n  border-radius: 20px;\n  color: #FFF;\n  transform: translateX(-50%);\n  text-align: center;\n  font-family: Arial, Helvetica, sans-serif;\n}\n",D='<svg id="reticle" viewBox="0 0 133 100"\n    xmlns="http://www.w3.org/2000/svg">\n  <mask id="reticle-cut-out">\n    <rect id="reticle-cut-out-outer" width="133" height="100" x="0" y="0"\n        fill="#FFF" />\n    <rect id="reticle-cut-out-inner" x="24" y="8" width="85" height="85" rx="2"\n        ry="2" fill="#000" />\n  </mask>\n  <rect id="reticle-box" width="133" height="100" x="0" y="0"\n      fill="rgba(0,0,0,0.4)" mask="url(#reticle-cut-out)" />\n</svg>\n<button id="close">Close</button>\n';class L extends HTMLElement{constructor(){super(),this.captureScale=.5,this.captureRate=0,this.capturePng=!1,this.flipped=!1,this.paused=!1,this.root=this.attachShadow({mode:"open"}),this.lastCapture=-1,this.root.innerHTML=`<style>${N}</style> ${D}`,this.root.addEventListener("click",t=>{"close"===(t.path?t.path[0]:t.composedPath()[0]).id&&w(L.closeEvent,this)})}disconnectedCallback(){this.stop()}start(t){if(this.stream)throw new Error("Stream already provided. Stop the capture first.");this.stream=t,this.initElementsIfNecessary();const e=d(this.captureScale,0),n=this.video,i=t=>{this.video&&this.ctx&&(this.paused||this.ctx.drawImage(this.video,0,0,this.video.videoWidth*e,this.video.videoHeight*e),0!==this.captureRate&&t-this.lastCapture>this.captureRate&&(this.lastCapture=t,this.captureFrame()),requestAnimationFrame(t=>i(t)))};n.muted=!0,n.srcObject=this.stream,n.play(),n.addEventListener("playing",async()=>{if(!this.video||!this.canvas||!this.ctx)return;let t=5,e=!0;for(;e;)t--,await new Promise(t=>requestAnimationFrame(t)),e=t>0&&(0===this.video.videoWidth||0===this.video.videoHeight);if(0===this.video.videoWidth||0===this.video.videoHeight)throw new Error("Video has width or height of 0");this.canvas.width=this.video.videoWidth*this.captureScale,this.canvas.height=this.video.videoHeight*this.captureScale,this.setReticleOrientation(this.canvas.height>this.canvas.width),this.flipped&&(this.ctx.translate(.5*this.canvas.width,0),this.ctx.scale(-1,1),this.ctx.translate(.5*-this.canvas.width,0)),requestAnimationFrame(t=>{i(t),w(L.startEvent,this)})},{once:!0})}async captureFrame(){if(!this.ctx||!this.canvas)throw new Error("Unable to capture frame");return new Promise(t=>{const e=this.canvas,n=this.ctx;let i;this.capturePng?((i=new Image).src=e.toDataURL("image/png"),i.onload=(()=>{0!==this.captureRate&&w(L.frameEvent,this,{imgData:i}),t(i)})):(i=n.getImageData(0,0,e.width,e.height),0!==this.captureRate&&w(L.frameEvent,this,{imgData:i}),t(i))})}stop(){if(!this.stream||!this.ctx||!this.canvas)return;const t=this.stream.getTracks();for(const e of t)e.stop();this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.remove(),this.video=void 0,this.stream=void 0,this.canvas=void 0,this.ctx=void 0,w(L.stopEvent,this)}setReticleOrientation(t){const e=this.root.querySelector("#reticle");if(e){if(t){e.setAttribute("viewBox","0 0 100 133");const t=e.querySelector("#reticle-cut-out-outer"),n=e.querySelector("#reticle-cut-out-inner"),i=e.querySelector("#reticle-box");if(!t||!n||!i)return;t.setAttribute("width","100"),t.setAttribute("height","133"),n.setAttribute("x","8"),n.setAttribute("y","24"),i.setAttribute("width","100"),i.setAttribute("height","133")}e.style.opacity="1"}}initElementsIfNecessary(){if(!this.canvas){if(this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),!this.ctx)throw new Error("Unable to create canvas context");this.root.appendChild(this.canvas)}this.video||(this.video=document.createElement("video"))}}function R(t=200){"vibrate"in navigator&&navigator.vibrate(t)}function M(t,e){return t+"__"+e}L.defaultTagName="stream-capture",L.frameEvent="captureframe",L.startEvent="capturestarted",L.stopEvent="capturestopped",L.closeEvent="captureclose";class T{decode(t){return this.decodeUnknown(t).flat()}decodeUnknown(t){if(Array.isArray(t))return this.decodeArray(t);if(!("@type"in t)||"string"!=typeof t["@type"])return[];switch(t["@type"]){case"DataFeed":return this.decodeDataFeed(t);case"ARArtifact":return this.decodeArArtifact(t);default:return[]}}decodeArray(t){return t.map(t=>this.decodeUnknown(t)).flat()}decodeDataFeed(t){const e=t.dataFeedElement;return e?Array.isArray(e)?this.decodeArray(e):this.decodeUnknown(e):[]}decodeArArtifact(t){return[t]}}class F{constructor(){this.markers=new Map}addMarker(t,e){e.text&&this.markers.set(e.text,{target:e,artifact:t})}findRelevantArtifacts(t){const e=[];for(const n of t){if(!n.value)continue;const t=this.markers.get(n.value);t&&e.push(t)}return e}}const B=new class{constructor(){this.decoder=new T}async fromHtmlUrl(t){const e=await fetch(t.toString()),n=await e.text(),i=(new DOMParser).parseFromString(n,"text/html");return this.fromDocument(i,t)}async fromJsonUrl(t){const e=await fetch(t.toString());if(!e.ok)throw Error(e.statusText);const n=await e.json();return this.fromJson(n)}async fromDocument(t,e){const n=[],i=t.querySelectorAll("script[type='application/ld+json']:not([src])");for(const t of i)n.push(this.fromJson(JSON.parse(t.textContent||"")));const o=t.querySelectorAll("script[type='application/ld+json'][src]");for(const t of o){const i=t.getAttribute("src");i&&n.push(this.fromJsonUrl(new URL(i,e)))}const r=t.querySelectorAll("link[rel='alternate'][type='application/ld+json'][href]");for(const t of r){const i=t.getAttribute("href");i&&n.push(this.fromJsonUrl(new URL(i,e)))}return(await Promise.all(n)).flat(1)}async fromJson(t){return this.decoder.decode(t)}},U=new class{constructor(){this.markerStore=new F}addArtifact(t){if(!t.arTarget)return;let e=[];e=Array.isArray(t.arTarget)?t.arTarget:[t.arTarget];for(const n of e)switch(n["@type"]||""){case"Barcode":this.markerStore.addMarker(t,n)}}findRelevantArtifacts(t,e){return this.markerStore.findRelevantArtifacts(t)}},O=new class{constructor(){this.artstores=[],this.nearbyMarkers=new Map,this.nearbyResults=new Set,this.currentGeolocation={}}async addArtifactStore(t){return this.artstores.push(t),this.generateDiffs()}async updateGeolocation(t){return this.currentGeolocation=t,this.generateDiffs()}async markerFound(t){return this.nearbyMarkers.set(M(t.type,t.value),t),this.generateDiffs()}async markerLost(t){return this.nearbyMarkers.delete(M(t.type,t.value)),this.generateDiffs()}async generateDiffs(){const t=new Set(this.artstores.map(t=>t.findRelevantArtifacts(Array.from(this.nearbyMarkers.values()),this.currentGeolocation)).flat(1)),e=[...t].filter(t=>!this.nearbyResults.has(t)),n=[...this.nearbyResults].filter(e=>!t.has(e)),i={found:[],lost:[]};for(const{target:t,artifact:n}of e){const e=n.arContent;i.found.push({target:t,content:e,artifact:n})}for(const{target:t,artifact:e}of n){const n=e.arContent;i.lost.push({target:t,content:n,artifact:e})}return this.nearbyResults=t,i}};O.addArtifactStore(U);const H=new Set,P="barcodedetect",j="cameraaccessdenied";customElements.define(L.defaultTagName,L),customElements.define(p.defaultTagName,p),customElements.define(c.defaultTagName,c),window.addEventListener(L.frameEvent,async function(t){if(Y)return;Y=!0;const e=t.target,{detail:n}=t,{detectionMode:i,imgData:o}=n,s=await r(o,{polyfillPrefix:q});for(const t of s)H.has(t.rawValue)||(H.add(t.rawValue),w(P,e,t.rawValue));s.length>0?(clearTimeout($),S()):i&&"active"===i&&A("No barcodes found");e.paused=!1,setTimeout(()=>{H.clear(),Y=!1},1e3);const a=document.querySelector(v.defaultTagName);if(!a)return;a.remove()}),window.addEventListener("offline",Z),window.addEventListener("online",Z);const q=window.PerceptionToolkit.config.root||"",z=r(new ImageData(1,1),{polyfillPrefix:q});async function G({detectionMode:t="passive",sitemapUrl:e}){try{await z,await async function(t){const e=[B.fromDocument(document,document.URL)];t&&e.push(B.fromJsonUrl(new URL(t,document.URL)));const n=await Promise.all(e);for(const t of n)for(const e of t)U.addArtifact(e)}(e),await async function(t){"passive"===t?W.captureRate=600:(A("Tap to capture"),W.addEventListener("click",async()=>{W.paused=!0,A("Processing...");const e=await W.captureFrame();w(L.frameEvent,W,{imgData:e,detectionMode:t})}));W.captureScale=.8,W.addEventListener(L.closeEvent,J),W.addEventListener(P,V);const e={video:{facingMode:"environment"}};try{let t=await navigator.mediaDevices.getUserMedia(e);const n=await navigator.mediaDevices.enumerateDevices(),i=await async function(t){return t.filter(t=>"videoinput"===t.kind).some(t=>{if(!("getCapabilities"in t))return!1;const e=t.getCapabilities();return!!e.facingMode&&e.facingMode.find(t=>"environment")})}(n);W.flipped=!i;let o=!1;window.addEventListener("visibilitychange",async()=>{if(!o)if(document.hidden)W.stop();else{if(o=!0,t=await navigator.mediaDevices.getUserMedia(e),o=!1,document.hidden)return;W.stop(),W.start(t)}}),W.start(t),document.body.appendChild(W),$=setTimeout(()=>{A("Make sure the barcode is inside the box.")},window.PerceptionToolkit.config.hintTimeout||5e3)}catch(t){w(j,window)}}(t)}catch(t){i(t.message,n.ERROR,"Barcode detection")}}async function V(t){const{detail:e}=t,n={type:"qrcode",value:e};R(200);try{const t=new URL(n.value);await async function(t){if(t.hostname!==window.location.hostname||t.port!==window.location.port||t.protocol!==window.location.protocol)return;const e=await B.fromHtmlUrl(t);for(const t of e)U.addArtifact(t)}(t)}catch(t){}!async function(t){if(!window.PerceptionToolkit.config.cardContainer)return;const e=window.PerceptionToolkit.config.cardContainer;if(!e.hasChildNodes())for(const{target:n,content:i,artifact:o}of t.found){const t=new p;t.src=i,e.appendChild(t)}}(await O.markerFound(n))}let $;const W=new L;function J(){W.stop(),W.remove(),S(),clearTimeout($)}let Y=!1;function Z(){const t=navigator.onLine;document.body.querySelector(L.defaultTagName)&&(t?S():A("Currently offline. Please reconnect to the network."))}return t.initialize=async function(t){const e=document.querySelector(k.defaultTagName);e?e.addEventListener(k.onboardingFinishedEvent,()=>{e.remove(),G(t)}):G(t)},t.close=J,t.vibrate=R,t.Card=p,t.ActionButton=c,t}({});